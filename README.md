# ALife
###### A wondrous world of AI
Симуляция искусственной жизни.
### Правила игры
Создается поле размером 60 на 60. Оно замкнуто по кругу - т.е если кто-то зайдет слева, выйдет справа. 
Сверху и снизу движение ограниченно стеной. При первом нажатии кнопки "Старт", создаем первые бактерии на случайной позиции.

У каждой бактерии свой искусственный интеллект, основанный на нейронной сети.
У каждой бактерии есть основной показатель - энергия. За каждый ход мы отнимаем некоторое количество энергии у всех бактерий.
Если ее становится слишком мало - существо умирает и на ее месте остается гниль, которая со временем оседает на дно.
Также на дне иногда спавнятся минералы, которые имеет те же характеристики, что и гниль.

Если энергии у клетки достаточно, то она размножается, т.е спавнит своего клона на какой-либо из клеток вокруг себя. 
Также есть небольшой шанс того, что в нейросети потомка произойдет мутация.

Ну а дальше за работу принимается эволюция и естественный отбор.
Если мутация произошла удачно - вид показывает свое превосходство над другими.

Способы получения энергии:
1) Фотосинтезировать. Чем ближе бактерия к верхней части аквариума - тем больше энергии она получит.
2) Съесть минерал.  
3) Съесть клетку, которая находится перед собой. При этом она забирает всю энергию съеденной клетки

### Графический интерфейс
С левой части экрана находятся основные кнопочки и рычажки.

Старт/Стоп - начать симуляцию или поставить ее на паузу, чтобы сделать классный скриншот

Поле скорость симуляции - скорость обновления экрана в милисекундах. 

Поле количество минералов - влияет на частоту появления минералов.

Поле количество солнечной энергии - чем больше, тем сильнее светит солнце. Чем глубже - тем сильнее свет рассеивается.
Рассчитывается по формуле геометрической прогрессии.

Поле шанс мутации - шанс изменения веса нейросети потомка.

Выпадающий список показ - форма показа симуляции. Команды - показывать бактерии, разделенные на команды.
"Команда" определяется цветом начальной бактерии, от которой она произошла.
Препочтительность - показывать бактерии, исходя из их препочтений в еде. Мясоеды краснеют, солнцееды зеленеют, а любители минералов синеют.

В процессе симуляции в опретивную память сохраняется вся история самой симуляции. Это дает следующие возможности:

Сохранить симуляцию - с помощью модуля pickle сохраняется вся история в файл с окончанием .sim.

Загрузить симуляцию - выгрузить из файла с окончанием .sim историю симуляции. При этом можно не только продолжить симуляцию с последней точки,
но и просмотреть историю развития.

Сохранить статистику - сохраняет все статистику в базу данных sqlite под названием statistics.db.
БД имеет 2 таблицы.

В saves записи о сохранениях, то есть название сохранений и дата. Так же есть столбец data_id, который указывает
на id записей статистики. По нему можно найти нужные записи.
 
В data хранятся сами записи симуляций. Она имеет следующие столбцы:

    0. data_id - id сохранения
    1. age - возраст карты, на котором сделана запись.
    2. minerals_setting - настройка количества минералов, настраивается игроком.
    3. sun_setting - настройка количества солнца, настраивается игроком.
    4. mutation_rate - настройка шанса мутации, настраивается игроком.
    5. bacteria_number - общее количество живых бактерий
    6. minerals_amount - общее количество минералов
    7. born_amount - количество рожденных
    8. died_amount - количество умерших от голода
    9. sun_eaters_amount - количество солнцеедных бактерий
    10. flesh_eaters_amount - количество мясоедных бактерий
    11. minerals_eaters_amount - количество минералоедных бактерий
    12. eaten_amount - количество съеденных бактерий.
    

Кнопка просмотр статистики - позволяет просматривать сохраненные записи. При нажатии открывается окно, в показываются все 
сохранения из таблицы saves. При выделении какой-либо ячейки в таблице справа покажутся все записи по выбранной симуляции.
    
Чекбокс "Не сохранять историю" - прекратить сохранять историю в оперативную память. Облегчает нагрузку на компьютер, но
кнопки "Сохранить историю" и "Сохранить статистику" будут не доступны. Если отключить, а через время включить,
в сохранение записи включены не будут.

### Архитектура
main.py - содержит основной класс программы, вызывает все окна, отрисовывает картинку.

classes.py - содержит классы для самой логики проведения симуляции. Например, класс бактерии или карты.

windows.py - содержит различные диалоговые окна. Вызывается только из main.py

statistics.db - файл со всей статистикой. Всегда должен быть в одной папке с программой.

main_ui.ui - файл с дизайном для основного окна. Всегда должен быть в одной папке с программой.

а так же иконки. 


### Особенности логики
У основного класса программы есть объект map_main, по данным которого происходит отрисовка.

map_main является экземпляром класса Map (содержится в classes.py). Он представляет из себя матрицу
60 на 60 с методами, управляющими этой матрицой. Каждый объект матрицы - экземпляр класса BaseCell
или его наследник.
 
Сам BaseCell - это пустая клетка, она даже не отрисовывается.
Bacteria - класс самой бактерии, Mineral - класс минерала.
 
Самая главный метод трех
вышеупомянутых классов - update. Аргуентами являются мартрица карты, положение текущей клетки на этой карте и карта солнца(более подробно рассказано в комментариях самой программы).
В то время как BaseCell ничего не делает, в Mineral и Bacteria производятся 
расчеты движения или действия, а так же пополнение энергии.
Метод возвращает 3 значения: new_i(int), new_j(int) и kill(bool). Если kill - True, то это значит
что клетку на позиции new_i и new_j мы съедаем. Если нет, то на эту клетку мы передвигаемся.
 
Обработка сигналов, посланными клетками происходит в методе update у класса Map. Обновление карты происходит в несколько шагов:

1) Передвигаем клетки
2) Генерируем минералы
3) Убийство тех, у кого 0 энергии.
4) Делим клетки.
5) Даем клетки возможность заного обновиться. (об этом в коде)


У основного класса программы имеется объект history - список, содержащий объекты класса Map
с каждого хода. Это позволяет нам воспроизвести симуляцию или собрать статистику. Но добавлять
в этот список нужно только клоны настоящих карт, иначе происходит что-то странное. Для этого у класса Map есть метод clone.


### Примененные технологии
PyQt5 для графического интерфейса и рисования

pickle для сохранения и загрузки симуляция

sqlite для использования баз данных

numpy для нейронных сетей